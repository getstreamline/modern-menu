!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).ModernMenu=t()}(this,(function(){"use strict";const e="ArrowLeft",t="ArrowUp",s="ArrowRight",i="ArrowDown";let n=0;function o(e){if(!e)return!1;const t=getComputedStyle(e);return"none"!==t.display&&"hidden"!==t.visibility&&null!==e.offsetParent}class r{constructor(e,t){this.menu=e,this.element=t,this.link=t.querySelector(":scope > a"),this.open=!1,this.element.getAttribute("role")||this.element.setAttribute("role","none"),this.link.getAttribute("role")||this.link.setAttribute("role","menuitem");const s=t.querySelector(":scope > ul");s&&(s.getAttribute("id")||s.setAttribute("id",function(){const e=n+1;return n=e,`sl-menu__submenu_${e}`}()),this.submenu=new e.constructor(s,{role:"menu",focusContainer:!1}),this.element.classList.add("sl-menu--has-submenu"),this.link.setAttribute("aria-haspopup","menu"),this.link.setAttribute("aria-controls",s.getAttribute("id")),this.toggle=document.createElement("button"),this.toggle.textContent="Toggle menu",this.toggle.setAttribute("type","button"),this.toggle.classList.add("sl-menu__toggle"),this.toggle.setAttribute("aria-controls",s.getAttribute("id")),this.toggle.setAttribute("tabindex","-1"),this.link.parentNode.insertBefore(this.toggle,this.link.nextSibling),s.classList.add("sl-menu__submenu"),s.getAttribute("aria-label")||s.setAttribute("aria-label",this.link.textContent)),this.update()}setOpen(e){this.submenu&&(this.open=e,this.submenu.setOpenIndex(-1),this.update())}update(){if(!this.submenu)return;this.open?(this.element.classList.remove("sl-menu--closed"),this.element.classList.add("sl-menu--open")):(this.element.classList.remove("sl-menu--open"),this.element.classList.add("sl-menu--closed"));const e=o(this.submenu.element)?"true":"false";this.link.setAttribute("aria-expanded",e),this.toggle.setAttribute("aria-expanded",e)}focus(){this.link.focus()}}return class{constructor(n,o={}){if(this.element=n,this.role=o.role||"menubar",this.focusContainer="boolean"!=typeof o.focusContainer||o.focusContainer,this.items=[],this.openIndex=-1,this.hoverMode=!0,this.hoverIntent=!1,this.element.getAttribute("role")||this.element.setAttribute("role",this.role),this.element.addEventListener("focusin",(e=>{if(this.focusContainer){const t=e.target;this.setActiveElement(t)}this.setOrientation()})),this.focusContainer){const e=e=>{-1===this.openIndex||this.element.contains(e.target)||(this.setActiveElement(this.items[this.openIndex].link),this.setOpenIndex(-1))};document.addEventListener("keydown",e),document.addEventListener("click",e),document.addEventListener("focusin",e)}let h,u;this.element.addEventListener("keydown",(e=>{if("Escape"===e.key&&-1!==this.openIndex){const t=this.items[this.openIndex];this.setOpenIndex(-1),t.focus(),e.stopPropagation(),e.preventDefault()}})),this.element.addEventListener("mouseenter",(()=>{this.setHoverMode()})),Array.from(this.element.children).forEach(((n,o)=>{const l=new r(this,n);this.items.push(l),l.link.setAttribute("tabindex","-1"),n.addEventListener("keydown",(n=>{const r="horizontal"===this.orientation?i:s,h="horizontal"===this.orientation?t:e,u="horizontal"===this.orientation?e:t,a="horizontal"===this.orientation?s:i;switch(n.key){case r:l.submenu&&this.openIndex!==o&&(this.setOpenIndex(o),l.submenu.focusFirstItem(),n.stopPropagation(),n.preventDefault());break;case h:l.submenu&&this.openIndex===o&&(this.setOpenIndex(-1),l.focus(),n.stopPropagation(),n.preventDefault());break;case u:if(o>0){if(!(o===this.openIndex)||"horizontal"===this.orientation){const e=this.items[o-1];e.submenu&&-1!==this.openIndex?(this.setOpenIndex(o-1),e.submenu.focusFirstItem()):(this.setOpenIndex(-1),e.focus())}n.stopPropagation(),n.preventDefault()}break;case a:if(o<this.items.length-1){const e=this.items[o+1];e.submenu&&-1!==this.openIndex?(this.setOpenIndex(o+1),e.submenu.focusFirstItem()):(this.setOpenIndex(-1),e.focus())}n.stopPropagation(),n.preventDefault();break;case"Home":if(this.items.length>0){const e=this.items[0];e.submenu&&-1!==this.openIndex?(this.setOpenIndex(1),e.submenu.focusFirstItem()):(this.setOpenIndex(-1),e.focus()),n.stopPropagation(),n.preventDefault()}break;case"End":if(this.items.length>0){const e=this.items[this.items.length-1];e.submenu&&-1!==this.openIndex?(this.setOpenIndex(this.items.length-1),e.submenu.focusFirstItem()):(this.setOpenIndex(-1),e.focus()),n.stopPropagation(),n.preventDefault()}}})),n.addEventListener("mouseenter",(()=>{this.hoverMode&&(h&&(clearTimeout(h),h=void 0),this.hoverIntent?this.setOpenIndex(o):h=setTimeout((()=>{this.hoverMode&&(this.hoverIntent=!0,this.setOpenIndex(o))}),400),u&&(clearTimeout(u),u=void 0))})),n.addEventListener("mousemove",(()=>{this.hoverMode&&!this.hoverIntent&&(u&&clearTimeout(u),u=setTimeout((()=>{this.hoverIntent=!0,this.setOpenIndex(o)}),40))})),n.addEventListener("mouseleave",(()=>{this.hoverMode&&(h&&clearTimeout(h),h=setTimeout((()=>{this.openIndex===o&&(this.hoverIntent=!1,this.setOpenIndex(-1))}),400),u&&(clearTimeout(u),u=void 0))})),l.submenu&&l.toggle&&l.toggle.addEventListener("click",(()=>{this.openIndex===o?(this.setOpenIndex(-1),l.focus()):(this.setOpenIndex(o),l.submenu.focusFirstItem())}))})),this.focusContainer&&this.items.length>0&&this.setActiveElement(this.items[0].link),this.setOrientation(),this.update()}setActiveElement(e){if(!this.element.contains(e))return;this.prevActiveElement&&this.prevActiveElement.setAttribute("tabindex","-1");const t=e;t.setAttribute("tabindex","0"),this.prevActiveElement=t}setOrientation(){if(o(this.element)&&this.items.length>=2){const e=this.items[0].element.getBoundingClientRect(),t=this.items[1].element.getBoundingClientRect(),s=Math.abs(t.left-e.left),i=Math.abs(t.top-e.top);this.orientation=s>i?"horizontal":"vertical"}else"menubar"===this.role?this.orientation="horizontal":this.orientation="vertical";this.element.setAttribute("aria-orientation",this.orientation)}setHoverMode(){this.hoverMode=!this.items.some((e=>e.toggle&&o(e.toggle)))}setOpenIndex(e){this.openIndex=e,this.update()}update(){this.items.forEach(((e,t)=>{e.setOpen(t===this.openIndex)}))}focusFirstItem(){0!==this.items.length&&this.items[0].focus()}}}));
