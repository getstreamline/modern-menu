var e="ArrowLeft",t="ArrowUp",n="ArrowRight",i="ArrowDown",s=0;function o(e){if(!e)return!1;var t=getComputedStyle(e);return"none"!==t.display&&"hidden"!==t.visibility&&null!==e.offsetParent}var r=function(){function e(e,t){this.menu=e,this.element=t,this.link=t.querySelector(":scope > a"),this.open=!1,this.element.getAttribute("role")||this.element.setAttribute("role","none"),this.link.getAttribute("role")||this.link.setAttribute("role","menuitem");var n,i=t.querySelector(":scope > ul");i&&(i.getAttribute("id")||i.setAttribute("id",(s=n=s+1,"sl-menu__submenu_"+n)),this.submenu=new e.constructor(i,{role:"menu",focusContainer:!1}),this.element.classList.add("sl-menu--has-submenu"),this.link.setAttribute("aria-haspopup","menu"),this.link.setAttribute("aria-controls",i.getAttribute("id")),this.toggle=document.createElement("button"),this.toggle.textContent="Toggle menu",this.toggle.setAttribute("type","button"),this.toggle.classList.add("sl-menu__toggle"),this.toggle.setAttribute("aria-controls",i.getAttribute("id")),this.toggle.setAttribute("tabindex","-1"),this.link.parentNode.insertBefore(this.toggle,this.link.nextSibling),i.classList.add("sl-menu__submenu"),i.getAttribute("aria-label")||i.setAttribute("aria-label",this.link.textContent)),this.update()}var t=e.prototype;return t.setOpen=function(e){this.submenu&&(this.open=e,this.submenu.setOpenIndex(-1),this.update())},t.update=function(){if(this.submenu){this.open?(this.element.classList.remove("sl-menu--closed"),this.element.classList.add("sl-menu--open")):(this.element.classList.remove("sl-menu--open"),this.element.classList.add("sl-menu--closed"));var e=o(this.submenu.element)?"true":"false";this.link.setAttribute("aria-expanded",e),this.toggle.setAttribute("aria-expanded",e)}},t.focus=function(){this.link.focus()},e}(),u=function(){function s(s,o){var u,a,l=this;if(void 0===o&&(o={}),this.element=s,this.role=o.role||"menubar",this.focusContainer="boolean"!=typeof o.focusContainer||o.focusContainer,this.items=[],this.openIndex=-1,this.hoverMode=!0,this.hoverIntent=!1,this.element.getAttribute("role")||this.element.setAttribute("role",this.role),this.element.addEventListener("focusin",(function(e){if(l.focusContainer){var t=e.target;l.setActiveElement(t)}l.setOrientation()})),this.focusContainer){var h=function(e){-1===l.openIndex||l.element.contains(e.target)||(l.setActiveElement(l.items[l.openIndex].link),l.setOpenIndex(-1))};document.addEventListener("keydown",h),document.addEventListener("click",h),document.addEventListener("focusin",h)}this.element.addEventListener("keydown",(function(e){if("Escape"===e.key&&-1!==l.openIndex){var t=l.items[l.openIndex];l.setOpenIndex(-1),t.focus(),e.stopPropagation(),e.preventDefault()}})),this.element.addEventListener("mouseenter",(function(){l.setHoverMode()})),Array.from(this.element.children).forEach((function(s,o){var h=new r(l,s);l.items.push(h),h.link.setAttribute("tabindex","-1"),s.addEventListener("keydown",(function(s){var r="horizontal"===l.orientation?i:n,u="horizontal"===l.orientation?t:e,a="horizontal"===l.orientation?e:t,m="horizontal"===l.orientation?n:i;switch(s.key){case r:h.submenu&&l.openIndex!==o&&(l.setOpenIndex(o),h.submenu.focusFirstItem(),s.stopPropagation(),s.preventDefault());break;case u:h.submenu&&l.openIndex===o&&(l.setOpenIndex(-1),h.focus(),s.stopPropagation(),s.preventDefault());break;case a:if(o>0){if(!(o===l.openIndex)||"horizontal"===l.orientation){var d=l.items[o-1];d.submenu&&-1!==l.openIndex?(l.setOpenIndex(o-1),d.submenu.focusFirstItem()):(l.setOpenIndex(-1),d.focus())}s.stopPropagation(),s.preventDefault()}break;case m:if(o<l.items.length-1){var c=l.items[o+1];c.submenu&&-1!==l.openIndex?(l.setOpenIndex(o+1),c.submenu.focusFirstItem()):(l.setOpenIndex(-1),c.focus())}s.stopPropagation(),s.preventDefault();break;case"Home":if(l.items.length>0){var p=l.items[0];p.submenu&&-1!==l.openIndex?(l.setOpenIndex(1),p.submenu.focusFirstItem()):(l.setOpenIndex(-1),p.focus()),s.stopPropagation(),s.preventDefault()}break;case"End":if(l.items.length>0){var f=l.items[l.items.length-1];f.submenu&&-1!==l.openIndex?(l.setOpenIndex(l.items.length-1),f.submenu.focusFirstItem()):(l.setOpenIndex(-1),f.focus()),s.stopPropagation(),s.preventDefault()}}})),s.addEventListener("mouseenter",(function(){l.hoverMode&&(u&&(clearTimeout(u),u=void 0),l.hoverIntent?l.setOpenIndex(o):u=setTimeout((function(){l.hoverMode&&(l.hoverIntent=!0,l.setOpenIndex(o))}),400),a&&(clearTimeout(a),a=void 0))})),s.addEventListener("mousemove",(function(){l.hoverMode&&!l.hoverIntent&&(a&&clearTimeout(a),a=setTimeout((function(){l.hoverIntent=!0,l.setOpenIndex(o)}),40))})),s.addEventListener("mouseleave",(function(){l.hoverMode&&(u&&clearTimeout(u),u=setTimeout((function(){l.openIndex===o&&(l.hoverIntent=!1,l.setOpenIndex(-1))}),400),a&&(clearTimeout(a),a=void 0))})),h.submenu&&h.toggle&&h.toggle.addEventListener("click",(function(){l.openIndex===o?(l.setOpenIndex(-1),h.focus()):(l.setOpenIndex(o),h.submenu.focusFirstItem())}))})),this.focusContainer&&this.items.length>0&&this.setActiveElement(this.items[0].link),this.setOrientation(),this.update()}var u=s.prototype;return u.setActiveElement=function(e){if(this.element.contains(e)){this.prevActiveElement&&this.prevActiveElement.setAttribute("tabindex","-1");var t=e;t.setAttribute("tabindex","0"),this.prevActiveElement=t}},u.setOrientation=function(){if(o(this.element)&&this.items.length>=2){var e=this.items[0].element.getBoundingClientRect(),t=this.items[1].element.getBoundingClientRect(),n=Math.abs(t.left-e.left),i=Math.abs(t.top-e.top);this.orientation=n>i?"horizontal":"vertical"}else"menubar"===this.role?this.orientation="horizontal":this.orientation="vertical";this.element.setAttribute("aria-orientation",this.orientation)},u.setHoverMode=function(){this.hoverMode=!this.items.some((function(e){return e.toggle&&o(e.toggle)}))},u.setOpenIndex=function(e){this.openIndex=e,this.update()},u.update=function(){var e=this;this.items.forEach((function(t,n){t.setOpen(n===e.openIndex)}))},u.focusFirstItem=function(){0!==this.items.length&&this.items[0].focus()},s}();export{u as default};
